############################
# LVGL OTA PAGE (OVERLAY)
############################
lvgl:
  pages:
    - id: ota_page
      widgets:
        - obj:
            width: 100%
            height: 100%
            bg_color: 0x000000
            bg_opa: 80%

            widgets:
              - label:
                  id: ota_title
                  text: "Firmware Update"
                  align: TOP_MID
                  y: 20
                  text_font: montserrat_24

              - bar:
                  id: ota_bar
                  width: 80%
                  height: 30
                  align: CENTER
                  min_value: 0
                  max_value: 100
                  value: 0

              - label:
                  id: ota_percent
                  text: "0 %"
                  align: CENTER
                  y: 40
                  text_font: montserrat_20

############################
# HTTP REQUEST OTA (UX PROGRESS)
############################
script:
  - id: http_ota_progress_simulation
    mode: restart
    then:
      - lambda: |-
          id(ota_active) = true;
          id(ota_progress) = 0;
      - light.turn_on: display_backlight
      - lvgl.page.show: ota_page
      - lvgl.label.update:
          id: ota_title
          text: "Firmware Download"
      - repeat:
          count: 100
          then:
            - delay: 300ms
            - lambda: |-
                id(ota_progress) += 1;
            - lvgl.bar.update:
                id: ota_bar
                value: !lambda "return id(ota_progress);"
            - lvgl.label.update:
                id: ota_percent
                text: !lambda |-
                  char buf[8];
                  snprintf(buf, sizeof(buf), "%d %%", id(ota_progress));
                  return std::string(buf);